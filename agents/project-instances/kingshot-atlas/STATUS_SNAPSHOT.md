# Status Snapshot - Kingshot Atlas

**Generated:** 2026-02-20  
**Generated By:** Atlas Director  
**Next Update:** After any significant work completion

---

## Project Health

| Aspect | Status | Notes |
|--------|--------|-------|
| Frontend | ✅ Operational | React + TypeScript, Vite build, Cloudflare Pages |
| Backend | ✅ Operational | FastAPI on Render, 12 routers, dual-DB (SQLite + Supabase) |
| Tests | ✅ Passing | API tests + Playwright E2E + Lighthouse in CI |
| Deployment | ✅ Live | Cloudflare Pages (frontend), Render (API + Discord bot) |
| Discord Bot | ✅ Operational | CF Worker proxy, Settler/Supporter role sync, telemetry, /kingdom /compare /predict /history /codes /redeem /link commands |
| SEO | ✅ Enhanced | Dynamic sitemap (1328 URLs), edge-side meta injection (HTMLRewriter), hreflang for 9 languages, BreadcrumbList JSON-LD, per-page canonicals |
| i18n | ✅ 9 Languages | EN, ES, FR, ZH, DE, KO, JA, AR, TR |
| Consistency Lint | ✅ Strict | 0 warnings, CI blocks drift on every PR |
| Codebase Health | ✅ Audited | ~1340 lines dead code removed, structured logging, centralized config, admin.py split into 8 modules, console.log→logger.ts |
| Subscribers | ✅ 5 Active | ~$24.96 MRR, 2 tiers (Free + Atlas Supporter $4.99/mo or $49.99/yr) |
| Onboarding | ✅ 4-Stage Funnel | SignupNudgeBar → WelcomeToAtlas → BattlePlannerTrial → ConversionBanner |

---

## Active Work

| Task | Owner | Status |
|------|-------|--------|
| Rally Session Persistence + EvCard Countdown + UTC Timestamp | Product Engineer | ✅ Complete — `rally_sessions` Supabase table with auto-save/restore for queue recovery. EvCard shows live "fires in Xh Ym" countdown. Rally copy text Start At now in UTC. |
| Bot Dashboard Timezone Fix + Rally Copy Overhaul | Product Engineer | ✅ Complete — Fixed critical timezone bug in `getNextEventDates()`: all date math now uses UTC methods. Bear Hunt, Swordland, Tri-Alliance dates now correct. `fmtDate` displays UTC. Rally copy text shortened (no gap/fill/march details), added "Start at HH:MM:SS" with 30s buffer for text-based coordination. |
| Rally Coordinator i18n + Bot Dashboard Alliance Events | Product Engineer | ✅ Complete — 47 missing rallyCoordinator keys translated to 8 langs. Bot Dashboard: next event date preview, NULL reference_date validation, Verify Schedule button (next 5 dates), isEventDay() 31 unit tests. Bot Health: NULL reference_date warning banner. Discord welcome rewritten as concise embed. Profile header typo fixed. /improve workflow strengthened. |
| Rally Coordinator Accessibility Phase 2 | Product Engineer | ✅ Complete — Focus trap in PlayerModal, aria-live queue announcements, keyboard reordering (Alt+Arrow/Delete), prefers-reduced-motion + forced-colors support, 7 empty-state i18n keys × 8 langs. Alliance event reference dates fixed in Supabase (VV Feb 24, SS Feb 22, TAC Feb 21). |
| Rally Coordinator Accessibility Pass | Product Engineer | ✅ Complete — WCAG AA contrast fixes, visible focus rings, ARIA labels/roles on all interactive elements, keyboard nav (slider arrow keys, Enter/Space on pills, Escape to close modals), role=dialog/alertdialog on modals, tablist on mobile tabs, aria-pressed on toggles, guided empty states, aria-live on status messages. 8 new EN i18n keys. |
| Prep Scheduler Mobile UX Pass (Batch 3) | Product Engineer | ✅ Complete — iOS auto-zoom fix, TimeRangePicker stacked mobile layout, collapsible manager actions, short day tab labels, collapsible slot grid. 11 new i18n keys × 9 langs × 2 dirs. |
| Prep Scheduler Improvements (Batch 2) | Product Engineer | ✅ Complete — Parallel init fetch, i18n deadline countdown, i18n toast labels, empty state landing, duplicate schedule prevention. 8 new i18n keys × 9 langs × 2 dirs. |
| Discord Welcome Message Overhaul | Product Engineer | ✅ Complete — Embedded → plain text, 20 variations with Atlas voice, user mention, dynamic channel mentions, Explorer role preserved. |
| Component Refactoring Phase 3 | Product Engineer | ✅ Complete — RecruiterDashboard (814→275) and RallyCoordinator (997→392) split into hooks + sub-components |
| Console.log Cleanup | Product Engineer | ✅ Complete — 60+ calls replaced with logger.ts across 30+ files |
| Admin.py Extraction | Platform Engineer | ✅ Complete — 1941-line file → 8 sub-modules, 35 routes preserved |
| ESLint-disable Audit | Platform Engineer | ✅ Complete — 16 comments audited, 7 converted to React Query, 9 intentional non-fetch |
| ADR Documentation | Platform Engineer | ✅ Complete — ADR-021 through ADR-025 added to DECISIONS.md |
| TypeScript 5.x Upgrade | Platform Engineer | ✅ Complete — package.json has ~5.7.0, .npmrc workaround can be removed |
| React Query Migration Phase 1 | Platform Engineer | ✅ Complete — 6 data-fetch useEffects → useQuery hooks (ADR-022) |
| React Query Migration Phase 2 (Transfer Hub) | Platform Engineer | ✅ Complete — 7 hooks in useTransferHubQueries.ts, server-side review view, error boundaries, applicant notifications |
| Transfer Hub Phase 3 (Recruiter + Polish) | Platform Engineer | ✅ Complete — RecruiterDashboard React Query, decline confirmation, two-phase kingdom pagination, 15 silent catch→logger |
| Transfer Hub Phase 5 (Enhancements) | Product Engineer | ✅ Complete — Tier badge removal, persistent read tracking, expiry auto-cleanup, transferee messaging, smart recommendations, outcome tracking |

---

## Recently Completed (Feb 8–19)

| When | Agent | Task |
|------|-------|------|
| 2026-02-17 | Product Engineer | Transfer Hub Phase 5 — 6 features: tier badge removal, persistent read tracking (message_read_status table), application expiry auto-cleanup (pg_cron hourly), transferee-side messaging UI with real-time, smart invite recommendations (reverse match scoring), transfer outcome tracking (transfer_outcomes table). 3 DB migrations. |
| 2026-02-20 | Business Lead | Monetization & Growth — Ad-Free perk removed, 4-stage onboarding funnel (SignupNudgeBar, WelcomeToAtlas, BattlePlannerTrialTooltip, ConversionBanner), cancel survey with churn recovery (/cancel-survey), Kingdom Fund alliance pitch |
| 2026-02-19 | Product Engineer | Component refactoring Phase 3 — RecruiterDashboard (814→275 lines, 6 extractions: useRecruiterDashboard hook, RecruiterOnboarding, RecruiterSkeleton, NoEditorState, InboxTab, TeamTab) and RallyCoordinator (997→392 lines, 3 extractions: useRallyCoordinator hook, RallyPlayersColumn, BuffConfirmPopup) |
| 2026-02-19 | Platform Engineer | React Query migration Phase 1 — created useAdminQueries.ts, converted WebhookMonitor, TransferApplicationsTab, AdminDashboard (3), Admin (2), PremiumContext to useQuery hooks. ADR-022 updated. |
| 2026-02-16 | Platform Engineer | Admin.py extraction (73KB → 8 sub-modules), ESLint audit (16 comments — all intentional), 5 ADRs documented (021-025) |
| 2026-02-16 | Product Engineer | Console.log cleanup (60+ calls → logger.ts), X-User-Id CORS header removal |
| 2026-02-15 | Ops Lead | Stale doc archival — 18 files moved to docs/archive/ (4 root reports, 2 discord, 4 releases, 8 reviews). Cross-references updated in GOVERNANCE_CHECKLIST.md + consistency-lint.js. Archive README created. |
| 2026-02-15 | Atlas Director | Evaluation follow-up — 12 files fixed: env var naming (SUPPORTER fallback chain), .env.example modernized (REACT_APP→VITE), 6 active docs updated (Atlas Pro→Supporter, Recruiter tier removed), DECISIONS.md duplicate ADR-013 fixed, stale dates refreshed |
| 2026-02-15 | Ops Lead | Component refactoring Phase 2 — AdminDashboard (-280), TransferBoard (-236), Profile (-150), KingdomProfile (-93) into 8 new focused files |
| 2026-02-13 | Platform Engineer | Webhook hardening — idempotency guard, email fallback, Sentry alerts, health check fix |
| 2026-02-13 | Platform Engineer | Stripe webhook audit — already existed, hardened stale recruiter/pro refs, added yearly price, Stripe CLI docs |
| 2026-02-13 | Business Lead | Conversion optimization (yearly default) + infra hardening (getEffectiveTier removed, STRIPE_QUICK_SETUP.md overhauled) |
| 2026-02-13 | Business Lead | Annual plan i18n (9 langs), Best Value badge, legacy 'pro' normalization removed |
| 2026-02-13 | Business Lead | Annual plan launch ($49.99/yr) + recruiter backward compat removal from code |
| 2026-02-13 | Business Lead | Recruiter tier cleanup — removed stale Atlas Recruiter refs from docs, UI, i18n (9 langs) |
| 2026-02-13 | Design Lead | Shared Component Adoption Sprint — 5 inline buttons migrated, 2 dead files deleted (170 lines), new lint rule |
| 2026-02-13 | Platform Engineer | Structured logging (130 print→logger), centralized config.py (9 env vars), Alembic removed, API v2.0.0 |
| 2026-02-13 | Product Engineer | PE audit fixes — 1340 lines dead code removed (Upgrade.tsx, MetaAnalysis.tsx, ProBadge→SupporterBadge), FilterPanel integrated |
| 2026-02-13 | Atlas Director | Consistency lint strict mode — 27 warnings→0, banned terms cleaned, CI enforced |
| 2026-02-13 | Release Manager | Changelog.tsx updated with 6 daily entries (Feb 7-12), CHANGELOG.md updated |
| 2026-02-13 | Ops Lead | CI hardening — npm ci, npm cache, E2E quality gate, Lighthouse gate, Discord deploy notifications |
| 2026-02-12 | Product | Gift Code Redeemer — one-click redemption, bulk redeem, alt accounts, retry failed, Discord /codes /redeem /redeem-all |
| 2026-02-12 | Product | Co-editor invite loop bug fix (K200 CrabDragoons), Co-Editor UX hardening |
| 2026-02-12 | Product | Homepage quick menu (6 tiles), Gift Code landing page, Discord Bot Atlas rebrand, /link command |
| 2026-02-11 | Product | 9 languages (added KO, JA, AR, TR), KvK Battle Planner, Co-Editor System |
| 2026-02-11 | Product | Email system (templates, badges, threads, search, canned responses), Admin dashboard (tab extraction, search, CSV export) |
| 2026-02-11 | Platform | Response time tracking, churn alerts, weekly digest, trend sparklines, date range picker |
| 2026-02-10 | Product | Transfer Hub polish — shareable listings, copy as image, How It Works guide, match score tooltips, profile preview |
| 2026-02-10 | Design | Premium tier visual polish — Gold/Silver/Bronze gradients, hover glows, tier badge animations |
| 2026-02-09 | Product | Transfer Hub LAUNCHED — open to all linked users, self-kingdom protection, My Invites, recruiter onboarding |
| 2026-02-09 | Product | Homepage redesigned — QuickActions grid, Transfer Hub banner, mobile countdowns |
| 2026-02-09 | Product | Ambassador Network — /ambassadors directory, 4 tiers, review badges, referral tracking |
| 2026-02-08 | Product | Content gating, tier refactor (removed recruiter), RIVAL badge, SmartTooltips, return visit delta |
| 2026-02-07 | Platform | Atlas Score v3.1 — 0-100 scale, inflation fix, tier recalibration |
| 2026-02-07 | Business | Kingdom Fund Stripe integration — 4 price tiers, weekly depletion Edge Function |

---

## Blocked / Waiting

| Item | Owner | Notes |
|------|-------|-------|
| — | — | No blockers |

---

## Known Issues

| Issue | Severity | Owner | Notes |
|-------|----------|-------|-------|
| Discord sign-in intermittent | Medium | Platform | PKCE code_verifier can be lost on mobile in-app browsers / app switches. AuthCallback hardened with error param detection, non-blocking timeouts, Sentry captures. Monitor Sentry for `Auth callback timeout` events. Supabase Free plan "EXCEEDING USAGE LIMITS" may also cause intermittent failures. |
| ESLint-disable comments | Low | Product | 32 remaining (threshold 30) — all intentional non-fetch (canvas, keyboard, useMemo). |
| Large component files | Low | Product | 19 baselined files tracked. Header already refactored (334 lines + 3 sub-components in header-nav/). |
| TypeScript 5.7.0 | Info | Platform | Upgrade complete. `.npmrc` with `legacy-peer-deps=true` can be removed once verified in CI. |
| GSC Indexing | Low | Ops | 29% indexed → target 60%+. KvK opponent links converted from span+onClick to crawlable \<Link\> elements. Edge-side meta injection deployed. |

---

## Next Priorities

1. **Monitor GSC indexing rate** — Target 60%+ from 29%, submit URLs via GSC URL Inspection
2. **React Query Phase 2** — Convert mutation patterns (review/approve actions) to useMutation
3. **Monitor onboarding funnel** — Analyze drop-off in Plausible, A/B test ConversionBanner messaging
4. **GOVERNANCE_CHECKLIST.md refresh** — Open issues tracker is stale (Jan 26 items, many now fixed)
5. **sharing.test.ts canvas mocks** — 9 pre-existing test failures due to missing canvas mock methods

---

## Key Metrics

| Metric | Current | Target |
|--------|---------|--------|
| Kingdoms tracked | 1,204+ | Growing ✅ |
| Languages supported | 9 | 9 ✅ |
| Active subscribers | 5 | Growing |
| MRR | ~$24.96 | Growing — annual plan now available |
| API routers | 12 | — |
| Consistency lint warnings | 0 | 0 ✅ |
| Build status | ✅ Passing | Passing ✅ |

---

## Source of Truth Files

| Topic | Location |
|-------|----------|
| Visual styling | `/apps/web/src/STYLE_GUIDE.md` |
| Agent protocol | `/docs/AGENT_PROTOCOL.md` |
| Features registry | `/agents/project-instances/kingshot-atlas/FEATURES_IMPLEMENTED.md` |
| Architecture decisions | `/agents/project-instances/kingshot-atlas/DECISIONS.md` |
| Power tiers | `/apps/web/src/types/index.ts` |
| Transfer group config | Supabase `transfer_groups` table (source of truth), fallback: `/apps/web/src/config/transferGroups.ts` |

---

## Quick Commands

```bash
# Frontend dev
cd apps/web && npm run dev

# Backend dev  
cd apps/api && python -m uvicorn main:app --reload

# Run tests
cd apps/web && npm test

# Consistency lint
cd apps/web && node scripts/consistency-lint.js

# Build for production
cd apps/web && npm run build
```

---

*Updated after every significant task completion.*
